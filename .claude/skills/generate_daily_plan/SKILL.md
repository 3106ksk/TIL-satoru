# generate_daily_plan

週次戦略と前日の学習記録を参照して、翌日のdaily plan（学習計画）を自動生成する。

## Trigger Conditions
- 「明日の学習計画を作成して」
- 「daily planを生成して」
- 「〇月〇日の目標を作成して」
- 「今日の学習目標を作って」

## Inputs Required
1. **対象日付** (YYYY-MM-DD形式)
2. **学習可能時間** (例: "90分", "6時間", "18時以降の2時間")
3. **Day Mode** (OFF/Shift/特殊条件)

## Referenced Files
- `daily_plan/daily_{前日日付}_plan.md` - 前日の学習計画
- `weekly_strategies/{期間}_to_{期間}.json` - 当該週の週次戦略
- `daily/daily_{前日日付}.md` - 前日の学習記録（実績）

## Output
- `daily_plan/daily_{対象日付}_plan.md` - 翌日の学習計画ファイル

---

## Task Definition

あなたは学習計画の設計エージェントです。週次戦略と前日の学習実績を分析し、翌日の最適な学習計画を作成します。

### Step 1: 情報収集
以下のファイルを並行して読み込む:
1. 前日のdaily plan (`daily_plan/daily_{前日日付}_plan.md`)
2. 週次戦略 (`weekly_strategies/{期間}.json`)
3. 前日のdaily review (`daily/daily_{前日日付}.md`)

### Step 2: 状況分析
以下の観点で分析する:

**前日の実績確認**:
- Top1達成度
- Done条件の達成状況
- 持ち越しタスク（未達成タスク）
- Avg Deep Score（認知リソース状態）
- 学習時間（Budget vs 実績）
- Worked/Slipped/Insightsから得られる教訓

**週次ゴールとの整合性**:
- 週次成功条件への進捗
- 残りスケジュール
- 実験の進行状況

**当日の制約条件**:
- Day Mode（OFF/Shift）
- 学習可能時間
- 前日の認知リソース消耗度（バーンアウト兆候）

### Step 3: Top1とDone条件の設計

**原則**:
- **OFF日（6時間）**: 明確な成果物を伴うTop1を設定。Done条件は具体的かつ測定可能に
- **Shift日（90-120分）**: 時間ベースまたは最小成果で設定。低負荷タスクを優先
- **バーンアウト兆候あり**: 前日の学習時間がBudgetの140%超、またはHeadroom≦2の記録がある場合、低負荷タスクまたは完全休養を検討

**Top1の選定基準**:
1. 週次ゴールへの貢献度が高い
2. 前日の持ち越しタスクで優先度が高いもの
3. 当日の認知リソース状態に適した負荷レベル

**Done条件の設計**:
- 時刻指定（例: 12:00までに）または時間枠（例: 90分以内に）
- 具体的な成果物（例: GitHubにpushされている状態）
- 測定可能（達成/未達成が明確）

### Step 4: タスクシーケンスの設計

**時間帯ブロック**:
- 🌅 **午前ブロック**: 高DS時間帯。実装・設計など高負荷タスク
- 🌇 **午後ブロック**: 集中低下時。中負荷タスクまたは「切れたら→」タスク
- 🌙 **夜間ブロック**: 低DS時間帯。整理・振り返りのみ。新概念の定着・深い思考は禁止

**タスク配置の原則**:
- 午前に最重要タスク（Top1）を配置
- 午後は「切れたら→」として中低負荷タスクを1つ準備
- 夜間はknowledge_organization、daily_reviewのみ

**タイムボックスの設定**:
- OFF日: 主要タスクに時刻による強制打ち切りを設定（例: 12:00タイムボックス）
- Shift日: 全体を厳密にタイムボックス化（例: 18:00-19:30で終了）

### Step 5: リスク対策（If-Then）の設計

前日のSlippedから学んだパターンを活かし、以下の形式でリスク対策を設定:

| リスク | If（トリガー） | Then（対処） |
|---|---|---|
| （具体的なリスク） | （発生条件） | （対処アクション） |

**典型的なリスクパターン**:
- 技術的固着（30min超えて進展なし → 最小構成で先に進む）
- タイムボックス超過（時刻を過ぎた → 途中でも次へ移行）
- 認知疲弊（Headroom≦2 → 低負荷タスクへ切り替え）
- Flow状態（DS 4.0以上で継続中 → 切り替えない。義務ではない）

### Step 6: 週次ゴールとの接続

週次戦略の成功条件を参照し、以下を記載:
```
週次成功条件: （週次戦略から引用）
残りスケジュール: （残り日数と各日のMode）
```

**今日の成果が達成された場合の効果**:
- 週次ゴールへの貢献
- 次の日への接続
- リスク回避

### Step 7: ファイル生成

以下の構造でdaily planファイルを生成:

```markdown
# {日付}（{曜日}）{Day Mode} — 学習計画

## ■ Context
- **Day Mode**:
- **Budget**:
- **前日**:
- **前日の成果**: （✅/❌で列挙）
- **認知リソース状況**:

## ■ Top1 / Done条件
**Top1**:
**Done条件**:
**切れたら→**:

## ■ 本日のタスクシーケンス
### 🌅 午前ブロック（最高DS時間帯）
| ステップ | タスク | 目安時間 | メモ |

### 🌇 午後ブロック（集中低下時の切れたら→実行）
（OFF日のみ）

### 🌙 夜間ブロック（整理・振り返りのみ）

## ■ リスク対策（If-Then）
| リスク | If（トリガー） | Then（対処） |

## ■ 週次ゴールとの接続

## ■ Stats（学習後に記入）
## ■ Worked / Slipped / Insights（夜に記入）
## ■ Study Strategy for Next Day
```

---

## Quality Criteria

生成されたdaily planは以下を満たす必要がある:

1. **具体性**: Top1とDone条件が測定可能
2. **実現可能性**: 学習可能時間内で達成可能
3. **整合性**: 週次ゴールと前日の状況に整合
4. **リスク対策**: 前日のSlippedを活かしたIf-Thenルール
5. **認知負荷の考慮**: 前日のDS・学習時間から適切な負荷レベル

---

## Example Usage

**Input**:
```
日付: 2026-02-20
学習可能時間: 18時以降の90分
Day Mode: Shift
```

**Context**:
- 前日: 2/19 Focus Day、513分学習（Budget 360分の142.5%）
- 前日の成果: rails new完了、DB設計完了、技術選定リスト完了
- 認知リソース: バーンアウト兆候あり（Headroom=2）

**Output**: `daily_plan/daily_2026-02-20_plan.md`
- Top1: ルーティング設計（routes.rb）
- Done条件: 19:30までにroutes.rbがpushされている
- 90分タイムボックス、低負荷タスク設計
- リスク対策: 疲労時は最小構成で完了

---

## Notes

- **時間見積もり**: 前日のInsightsで「見積もり甘い」パターンが頻出する場合、タスク時間を1.5-2倍に設定
- **完璧主義の回避**: 「12:00タイムボックス」など強制打ち切りルールを明示
- **認知リソース保護**: 前日のバーンアウト兆候を最優先で考慮
- **週次実験の継続**: 週次戦略のexperiment（例: 「切れたら→」実験）を計画に組み込む
