# 2026-01-31 Daily Review

## Stats
- **Day Mode**: Off (OFF)
- **Total Min**: 287 min
- **Deep Score**: 3.62
- **Top1**: ブックマークボタンのajaxを完了。コメント投稿と削除機能を言語化する

## Context & Reflection
### Worked
- 事実: フェーズ１設計と定義言語化を行った / 理由: 分からないフローや箇所を明確にできるので、思考の混乱を防ぐことができて要点を抑えて学習できる

### Insight
- 事実: 日曜日は振り返りと計画に最適 / 次の一手: 仕事の休憩時間に1週間のログを整理してAIに分析し、帰宅後にその内容をもとに翌週の目標や過ごし方を考える
- 事実: 週初めのスタートが重要 / 次の一手: 月曜日の午前から学習をスタートできるように準備する

## Technical Learnings
### Rails: UIの特定のDOMのみを再レンダリングする方法
- **Question**: UIの特定のDOMのみを再レンダリングする方法
- **Conclusion**: `xxxx.turbo_stream` ファイルを作成し、対応するコントローラーのアクション実行時に Turbo Stream を生成する。`turbo_stream.xxx(アクション)` で DOM ID を指定して置換することで、全体をリロードせずに処理を行える。
- **Code**:
  ```erb
  <%= turbo_stream.replace "comment-form" do %>
  <%= turbo_stream.replace "bookmark-button-for-board-#{@board.id}" do %>
  ```

### Rails: アソシエーションによるデータ取得
- **Question**: なぜ `xxxx.comments` はメソッドで一括取得を行うことができるのか？
- **Conclusion**: アソシエーション（関連付け）によってメソッドが生成されるため。`user.comments` のようにユーザーに紐づくコメントを一覧取得できる。
- **Evidence**: ログにてSQLを確認すると `comments` テーブルから `WHERE` 句でログインユーザーのIDを条件にデータを取得していることが確認できる。
- **Code**:
  ```ruby
  irb(main):005:0> user.comments
    Comment Load (0.7ms)  SELECT `comments`.* FROM `comments` WHERE `comments`.`user_id` = 1 
   # user_id = 1を持つデータをcommentsテーブルから全件取得している
  ```

### Rails: Turbo Streamでのフォームリセットと空オブジェクト
- **Question**: なぜ `Comment.new` でフォームがリセット行えるのか？ `@comment` ではなく `Comment.new` を行っている理由は？
- **Conclusion**: `Comment.new` で中身が `nil` の空オブジェクトが生成され、それが `_form` パーシャルに渡されるためフォームが空になる。`@comment` を渡すと値が入った状態になってしまうため、リセット目的で `Comment.new` を渡す。
- **Code**:
  ```erb
  <%= turbo_stream.replace "comment-form" do %>
    <%= render 'comments/form', comment: Comment.new, board: @comment.board %>
  <% end %>
  
  # 結果としての空オブジェクト
  # <Comment:0x0000ffffa168fa78 id: nil, user_id: nil, ...>
  ```
